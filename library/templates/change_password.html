{% extends 'base.html' %}
{% load static %}
{% block title %}Change Password{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-5">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body p-4">
                    <!-- Heading -->
                    <h3 class="fw-bold text-center mb-4">üîë Change Password</h3>
                    <hr>

                    <!-- Success Message -->
                    {% if success %}
                        <div class="alert alert-success text-center">
                            ‚úÖ Password changed successfully!
                        </div>
                    {% endif %}

                    <!-- Error Message -->
                    {% if error %}
                        <div class="alert alert-danger text-center">
                            ‚ö†Ô∏è {{ error }}
                        </div>
                    {% endif %}

                    <!-- Change Password Form -->
                    <form method="POST">
                        {% csrf_token %}

                        <!-- Old Password -->
                        <div class="mb-3">
                            <label for="old_password" class="form-label fw-semibold">Old Password</label>
                            <div class="input-group">
                                <input type="password" name="old_password" id="old_password" class="form-control" placeholder="Enter old password" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('old_password', this)">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>

                        <!-- New Password -->
                        <div class="mb-3">
                            <label for="new_password" class="form-label fw-semibold">New Password</label>
                            <div class="input-group">
                                <input type="password" name="new_password" id="new_password" class="form-control" placeholder="Enter new password" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('new_password', this)">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <small id="passwordStrength" class="form-text mt-1"></small>
                        </div>

                        <!-- Confirm New Password -->
                        <div class="mb-3">
                            <label for="confirm_password" class="form-label fw-semibold">Confirm New Password</label>
                            <div class="input-group">
                                <input type="password" name="confirm_password" id="confirm_password" class="form-control" placeholder="Re-enter new password" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirm_password', this)">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-key-fill"></i> Update Password
                            </button>
                        </div>
                    </form>

                    <!-- Back Button -->
                    <div class="text-center mt-3">
                        <a href="/" class="text-decoration-none">
                            <i class="bi bi-arrow-left-circle"></i> Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Password Strength & Toggle Script -->
<script>
    // Show / Hide Password
    function togglePassword(fieldId, button) {
        const input = document.getElementById(fieldId);
        const icon = button.querySelector("i");
        if (input.type === "password") {
            input.type = "text";
            icon.classList.replace("bi-eye", "bi-eye-slash");
        } else {
            input.type = "password";
            icon.classList.replace("bi-eye-slash", "bi-eye");
        }
    }

    // Password Strength Indicator
    const newPasswordInput = document.getElementById("new_password");
    const strengthText = document.getElementById("passwordStrength");

    newPasswordInput.addEventListener("input", () => {
        const val = newPasswordInput.value;
        let strength = "";
        let color = "";

        if (val.length < 6) {
            strength = "Weak";
            color = "red";
        } else if (val.match(/[A-Z]/) && val.match(/[0-9]/) && val.length >= 8) {
            strength = "Strong";
            color = "green";
        } else {
            strength = "Medium";
            color = "orange";
        }

        strengthText.textContent = `Password Strength: ${strength}`;
        strengthText.style.color = color;
    });
</script>
{% endblock %}
